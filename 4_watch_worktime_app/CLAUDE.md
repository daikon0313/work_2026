# メニューバー常駐 作業計測アプリ（Mac）

## 目的
Mac のメニューバーに常駐する作業計測（ストップウォッチ）アプリを作成する。
作業終了時に、計測した時間を Google カレンダーの予定として自動登録することで、
作業ログを手動入力なしで記録できるようにする。

---

## 想定ユーザー
- Mac を日常的に使用する開発者・ナレッジワーカー
- 作業時間を Google カレンダーで管理・振り返りしたいユーザー

---

## アプリの基本仕様

### 起動形式
- メニューバー常駐型アプリ
- Dock には表示しない
- アプリ起動中は常にメニューバーから操作可能

---

## 機能要件

### 1. 作業時間計測
メニューバーから以下の操作を行う。

| 操作 | 内容 |
|---|---|
| Start | 作業計測開始 / 再開 |
| Pause | 作業の一時中断（経過時間は保持） |
| Stop | 作業計測終了 |

- 計測中は経過時間（hh:mm:ss）をメニューバーに表示する
- Pause 後に Start を押すことで計測を再開できる
- Stop 時点で作業を確定する

---

### 2. 作業内容の入力
Stop 押下後、入力ダイアログを表示し以下を入力する。

- 作業タイトル（必須）
- 作業内容（任意）

---

### 3. Google カレンダー連携
作業確定後、Google カレンダーにイベントを自動作成する。

| 項目 | 内容 |
|---|---|
| 開始時刻 | Start を最初に押した時刻 |
| 終了時刻 | Stop を押した時刻 |
| 件名（summary） | 作業タイトル |
| 説明（description） | 作業内容 |

- 登録先はデフォルトで primary カレンダー
- OAuth（Desktop Application）で認証する

---

## 非機能要件
- Mac 専用アプリ（Windows / Linux 非対応）
- バックグラウンドで軽量に動作する
- 手動で Quit するまで常駐する

---

## 技術選定

### 使用技術
| 目的 | 技術 |
|---|---|
| 言語 | Python |
| メニューバーUI | rumps |
| 時間計測 | datetime / timedelta |
| カレンダー連携 | Google Calendar API |
| 認証 | OAuth 2.0（Desktop Application） |

---

### rumps を採用する理由
- macOS のメニューバー常駐に特化したライブラリである
- Cocoa（NSStatusItem）を簡単に扱える
- Electron や Tkinter より軽量に実装できる

---

## 認証方式（Google Calendar）
- Google Cloud Console で OAuth クライアント（Desktop App）を作成する
- 初回起動時にブラウザで Google ログインを行う
- 認証情報は token.json に保存する
- 2回目以降は refresh token を用いて自動認証する

---

## アプリ状態管理

| 変数 | 内容 |
|---|---|
| start_dt | 作業開始時刻 |
| last_resume_dt | 最後に再開した時刻 |
| elapsed | Pause を含めた累積経過時間 |
| running | 現在計測中かどうか |

---

## 今後の拡張候補（スコープ外）
- ログイン時の自動起動
- Mac 再起動後の計測状態復元
- 登録先カレンダーの選択機能
- 作業テンプレート（定例作業）
- 日次・週次の作業サマリー自動作成
- SwiftUI によるネイティブ実装への移行

---

## 対象外（現時点）
- モバイル対応
- チーム共有機能
- サーバーサイド構成
- データベースによる永続化
