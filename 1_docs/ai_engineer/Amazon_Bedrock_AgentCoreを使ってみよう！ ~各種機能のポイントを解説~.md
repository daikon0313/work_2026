# Amazon Bedrock AgentCore を使ってみよう！ ~各種機能のポイントを解説~

記事: https://speakerdeck.com/yuu551/amazon-bedrock-agentcorewoshi-tutemiyou-ge-zhong-ji-neng-nohointowojie-shuo-4

---

## 概要

Amazon Bedrock AgentCore は、AIエージェントのためのマネージドサービスです。エージェントの構築、実行、管理を簡素化し、開発者が独自のエージェントフレームワークを使用しながらAWSのインフラストラクチャとセキュリティの利点を活用できるようにします。

### AIエージェントとは
- ユーザーの代わりに自律的に行動する知的なAIシステム
- 計画立案、ツール使用、複数ステップのタスク実行が可能
- Foundation Modelを基盤に、追加の機能を組み込んだもの

---

## 主要機能

### 1. Runtime (ランタイム)
AIエージェントのホスティング機能を提供します。

**特徴:**
- エージェントをCloudFormationテンプレートで定義可能
- Docker イメージベースのデプロイメント
- 自動スケーリング対応
- 複数のエージェントフレームワークをサポート
  - Amazon Bedrock Agents (マネージドエージェント)
  - Strands Agents
  - LangGraph
  - その他カスタムフレームワーク

**仕組み:**
- エージェントをDockerコンテナとしてパッケージ化
- BedrockがECRからイメージをプルしてホスティング
- Lambda関数のようにリクエストに応じて実行

### 2. Identity (認証)
エージェントへのアクセス制御と外部サービスへの認証を管理します。

**Inbound Auth (インバウンド認証):**
- エージェントへのアクセス制御
- Amazon Cognito または OIDC プロバイダーと連携
- ユーザー認証情報をエージェントに渡す

**Outbound Auth (アウトバウンド認証):**
- エージェントが外部APIを呼び出す際の認証
- AWS Secrets Manager に保存された認証情報を使用
- OAuth 2.0、API Key、Basic認証などをサポート

**重要なポイント:**
- エージェントコード内で認証情報をハードコードする必要がない
- セキュアな認証情報管理
- ユーザーごとの権限制御が可能

### 3. Memory (メモリ)
会話の文脈とデータを保持する機能です。

**Short-term Memory (短期記憶):**
- セッション内の会話履歴を保持
- 同一セッション内でのコンテキスト維持
- sessionId を使用して管理

**Long-term Memory (長期記憶):**
- セッションを超えた情報の永続化
- ユーザーの好みや過去のやり取りを記憶
- memoryId を使用して管理
- Amazon Bedrock Knowledge Base との統合

**ユースケース:**
- チャットボットの文脈理解
- ユーザープロファイルの構築
- 継続的な対話の改善

### 4. Gateway (ゲートウェイ)
外部APIをエージェントのツールとして統合する機能です。

**特徴:**
- APIスキーマ(OpenAPI)からツール定義を自動生成
- 複数のAPIを統合可能
- 認証情報の管理(Outbound Authと連携)

**仕組み:**
1. OpenAPI仕様を用意
2. Gateway設定でAPIエンドポイントと認証を定義
3. エージェントから自然言語でツールを呼び出し
4. Gatewayが適切なAPIリクエストに変換

**メリット:**
- APIをツール化する際のボイラープレートコード削減
- 統一されたツール管理
- 認証の一元化

### 5. Built-in Tools (組み込みツール)
すぐに使える2つの強力なツールを提供します。

**Code Interpreter (コードインタープリター):**
- Pythonコードの実行環境
- データ分析、可視化、計算処理が可能
- ファイルのアップロード/ダウンロード対応
- pandas、matplotlib、numpy などのライブラリが利用可能

**Browser (ブラウザ):**
- Webページの閲覧とスクレイピング
- JavaScriptの実行が可能
- 動的なWebコンテンツの取得
- リアルタイム情報の収集

**使用方法:**
- CloudFormationテンプレートで有効化するだけ
- エージェントが必要に応じて自動的に使用

### 6. Observability (可観測性)
エージェントの動作をモニタリングし、デバッグを容易にします。

**機能:**
- **CloudWatch Logs**: 詳細なログ出力
- **CloudWatch Metrics**: パフォーマンスメトリクス
- **AWS X-Ray**: 分散トレーシング
- **OpenTelemetry対応**: カスタムトレースの追加が可能

**ログの内容:**
- エージェントの思考プロセス
- ツール呼び出しの詳細
- エラーとスタックトレース
- レスポンスタイム

**メリット:**
- エージェントの動作を可視化
- パフォーマンスの最適化
- 問題の迅速な特定と解決

---

## MCP (Model Context Protocol) との関係

**MCP とは:**
- AIアプリケーションとデータソース/ツールを接続する標準プロトコル
- Anthropic社が提唱

**AgentCore との統合:**
- MCPサーバーをAgentCoreのGatewayとして統合可能
- 標準化されたツール連携
- エコシステムとの相互運用性

---

## 実装のポイント

### エージェントのデプロイ
1. Dockerfileを作成してエージェントをコンテナ化
2. ECRにイメージをプッシュ
3. CloudFormationでAgentCore リソースを定義
4. デプロイして実行

### ベストプラクティス
- **セキュリティ**: 認証情報はSecrets Managerで管理
- **モニタリング**: CloudWatchで継続的に監視
- **メモリ管理**: 適切なメモリ戦略(Short-term/Long-term)を選択
- **ツール設計**: 必要なツールのみを有効化してコスト最適化

### コスト考慮事項
- Runtime: 実行時間に応じた課金
- Memory: ストレージ容量に応じた課金
- Gateway/Tools: API呼び出し回数に応じた課金

---

## まとめ

Amazon Bedrock AgentCore は、AIエージェントの開発・運用を大幅に簡素化するマネージドサービスです。

**主な利点:**
- インフラ管理の削減
- セキュアな認証・認可機能
- 豊富な組み込みツール
- 優れた可観測性
- 既存フレームワークとの互換性

**適用シーン:**
- カスタマーサポートエージェント
- データ分析アシスタント
- ワークフロー自動化
- 情報検索・統合システム

AgentCoreを活用することで、開発者はエージェントのビジネスロジックに集中でき、インフラやセキュリティはAWSに任せることができます。
